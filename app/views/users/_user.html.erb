<div class="d-flex">
  <div class="flex-shrink-0 w-25">
    <%= image_tag current_user.avatar_image_url, class: "me-3 rounded-circle img-cover img-medium" %>
  </div>

  <div class="media-body">
    <div class="d-flex justify-content-between align-items-center">
      <h1 class="mt-0 mb-3 display-4">
        <%= current_user.username %>
      </h1>

      <div>
        <span class="badge text-bg-secondary">
          <%= current_user.private? ? "Private" : "Public" %>
        </span>
      </div>
    </div>

    <div class="mb-4 d-flex justify-content-between">
      <div>
        <%=
          link_to "#",
            class: "link-underline link-underline-opacity-0 link-underline-opacity-100-hover",
            data: { 
              "bs-toggle": "modal", 
              "bs-target": "##{dom_id(current_user)}_followers"
            } do %>

          <span class="font-weight-bold">
            <%= current_user.followers.size %>
          </span>

          followers

        <% end %>
      </div>

      <div>
        <%=
          link_to "#",
            class: "link-underline link-underline-opacity-0 link-underline-opacity-100-hover",
            data: { 
              "bs-toggle": "modal", 
              "bs-target": "##{dom_id(current_user)}_following"
            } do %>

          <span class="font-weight-bold">
            <%= current_user.leaders.size %>
          </span>

          following

        <% end %>
      </div>

      <div>
        <%=
          link_to "#",
            class: "link-underline link-underline-opacity-0 link-underline-opacity-100-hover",
            data: { 
              "bs-toggle": "modal", 
              "bs-target": "##{dom_id(current_user)}_pending"
            } do %>

          <span class="font-weight-bold">
            <%= current_user.pending_sent_follow_requests.size %>
          </span>

          pending

        <% end %>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col">
        <% follow_request = current_user.pending_received_follow_requests.find_by(sender: @user) %>

        <% if follow_request %>
          <p class="lead text-center">
            <%= @user.username %> has sent you a follow request.
          </p>

          <% follow_request.status = "accepted" %>

          <%= form_with(model: follow_request) do |form| %>
            <%= form.hidden_field :status %>

            <%= form.submit "Accept #{@user.username}'s request", class: "btn btn-outline-success btn-block mb-3" %>
          <% end %>

          <% follow_request.status = "rejected" %>

          <%= form_with(model: follow_request) do |form| %>
            <%= form.hidden_field :status %>

            <%= form.submit "Decline #{@user.username}'s request", class: "btn btn-outline-danger btn-block mb-3" %>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col">
        <% follow_request = current_user.sent_follow_requests.find_by(recipient: @user) %>
        <% if follow_request %>
          <%= link_to follow_request, method: :delete, class: "btn btn-outline-secondary btn-block" do %>
            <% if follow_request.pending? %>
              Un-request
            <% else %>
              Un-follow
            <% end %>
          <% end %>
        <% else %>
          <%= render "follow_requests/form", follow_request: @user.received_follow_requests.build %>
        <% end %>
      </div>
    </div>

    <h3 class="h5">
      <%= current_user.name %>
    </h3>

    <p>
      <%= current_user.bio %>
    </p>

    <p>
    <%= link_to current_user.website, current_user.website, class: "link-underline link-underline-opacity-0 link-underline-opacity-100-hover" %>
    </p>
  </div>
</div>

<%=
  render "users/connected_users_modal",
    user: current_user,
    connected_users: current_user.followers,
    description: "followers",
    target: "#{dom_id(current_user)}_followers"
%>

<%=
  render "users/connected_users_modal",
    user: current_user,
    connected_users: current_user.leaders,
    description: "following",
    target: "#{dom_id(current_user)}_following"
%>

<%=
  render "users/connected_users_modal",
    user: current_user,
    connected_users:current_user.pending_sent_follow_requests.map(&:recipient),
    description: "pending",
    target: "#{dom_id(current_user)}_pending"
%>
